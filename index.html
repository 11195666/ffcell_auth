<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>方方格子自助授权系统</title>
    <link rel="stylesheet" href="/assets/style/style.css">
    <link rel="stylesheet" href="/assets/style/flatpickr.min.css">
    <link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon">
    <script src="/assets/style/flatpickr.js"></script>
    <script src="/assets/style/zh.js"></script>
</head>
<body>
    <div class="page-container">
        <div class="page-wrapper">
            <div class="brand-container">
                <div class="brand-content">
                    <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#4A90E2;stop-opacity:1" /><stop offset="100%" style="stop-color:#50E3C2;stop-opacity:1" /></linearGradient><linearGradient id="grad2" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#4a91e2c2;stop-opacity:1" /><stop offset="100%" style="stop-color:#50e3c2b0;stop-opacity:1" /></linearGradient></defs><path fill="#f0f2f5" d="M48.1,-69.1C62.7,-60.9,75.2,-47.8,79.5,-32.7C83.8,-17.6,80,-0.6,74.1,15.1C68.2,30.8,60.2,45.2,48.2,56.7C36.2,68.2,20.2,76.8,2.7,78.1C-14.8,79.5,-31.1,73.6,-45,63.9C-58.9,54.2,-70.5,40.7,-76.3,25.3C-82.1,9.9,-82.1,-7.3,-75.7,-21.8C-69.3,-36.3,-56.5,-48,-43.2,-57.1C-29.9,-66.2,-14.9,-72.7,1.4,-75.1C17.7,-77.5,35.4,-77.3,48.1,-69.1Z" transform="translate(100 100)" /><g transform="translate(50 50) scale(0.5)"><path d="M164.2,82.1A82.1,82.1,0,1,1,82.1,0,82.1,82.1,0,0,1,164.2,82.1Z" fill="#FFFFFF"/><path d="M164.2,82.1A82.1,82.1,0,1,1,82.1,0,82.1,82.1,0,0,1,164.2,82.1Z" fill="url(#grad2)" stroke="#FFF" stroke-width="5"/><path d="M129.5,50.6,73.6,106.5a8.2,8.2,0,0,1-11.6,0L34.7,79.2a8.2,8.2,0,0,1,11.6-11.6l21.5,21.5L117.9,39a8.2,8.2,0,1,1,11.6,11.6Z" fill="#FFFFFF"/></g></svg>
                    <h1 class="brand-title">方方格子授权系统</h1>
                    <p class="brand-subtitle">快速、安全、便捷地生成您的授权码。</p>
                    <div class="brand-socials">
                        <a class="brand-social-icon" href="javascript:void(0);" title="微信客服" data-qr-image="/assets/images/weixin_qr.png" data-qr-title="微信扫码联系"><svg viewBox="0 0 1024 1024"><path d="M683.058 364.695c11 0 22 1.016 32.943 1.976C686.564 230.064 538.896 128 370.681 128c-188.104 0.66-342.237 127.793-342.237 289.226 0 93.068 51.379 169.827 136.725 229.256L130.72 748.43l119.796-59.368c42.918 8.395 77.37 16.79 119.742 16.79 11 0 21.46-0.48 31.914-1.442a259.168 259.168 0 0 1-10.455-71.358c0.485-148.002 128.744-268.297 291.403-268.297l-0.06-0.06z m-184.113-91.992c25.99 0 42.913 16.79 42.913 42.575 0 25.188-16.923 42.579-42.913 42.579-25.45 0-51.38-16.85-51.38-42.58 0-25.784 25.93-42.574 51.38-42.574z m-239.544 85.154c-25.384 0-51.374-16.85-51.374-42.58 0-25.784 25.99-42.574 51.374-42.574 25.45 0 42.918 16.79 42.918 42.575 0 25.188-16.924 42.579-42.918 42.579z m736.155 271.655c0-135.647-136.725-246.527-290.983-246.527-162.655 0-290.918 110.88-290.918 246.527 0 136.128 128.263 246.587 290.918 246.587 33.972 0 68.423-8.395 102.818-16.85l93.809 50.973-25.93-84.677c68.907-51.93 120.286-119.815 120.286-196.033z m-385.275-42.58c-16.923 0-34.452-16.79-34.452-34.179 0-16.79 17.529-34.18 34.452-34.18 25.99 0 42.918 16.85 42.918 34.18 0 17.39-16.928 34.18-42.918 34.18z m188.165 0c-16.984 0-33.972-16.79-33.972-34.179 0-16.79 16.927-34.18 33.972-34.18 25.93 0 42.913 16.85 42.913 34.18 0 17.39-16.983 34.18-42.913 34.18z" fill="#09BB07"></path></svg></a>
                        <a class="brand-social-icon" href="javascript:void(0);" title="QQ客服" data-qr-image="/assets/images/qq_qr.png" data-qr-title="QQ扫码联系"><svg viewBox="0 0 1024 1024"><path d="M511.09761 957.257c-80.159 0-153.737-25.019-201.11-62.386-24.057 6.702-54.831 17.489-74.252 30.864-16.617 11.439-14.546 23.106-11.55 27.816 13.15 20.689 225.583 13.211 286.912 6.767v-3.061z" fill="#FAAD08"></path><path d="M496.65061 957.257c80.157 0 153.737-25.019 201.11-62.386 24.057 6.702 54.83 17.489 74.253 30.864 16.616 11.439 14.543 23.106 11.55 27.816-13.15 20.689-225.584 13.211-286.914 6.767v-3.061z" fill="#FAAD0O8"></path><path d="M497.12861 474.524c131.934-0.876 237.669-25.783 273.497-35.34 8.541-2.28 13.11-6.364 13.11-6.364 0.03-1.172 0.542-20.952 0.542-31.155C784.27761 229.833 701.12561 57.173 496.64061 57.162 292.15661 57.173 209.00061 229.832 209.00061 401.665c0 10.203 0.516 29.983 0.547 31.155 0 0 3.717 3.821 10.529 5.67 33.078 8.98 140.803 35.139 276.08 36.034h0.972z" fill="#000000"></path><path d="M860.28261 619.782c-8.12-26.086-19.204-56.506-30.427-85.72 0 0-6.456-0.795-9.718 0.148-100.71 29.205-222.773 47.818-315.792 46.695h-0.962C410.88561 582.017 289.65061 563.617 189.27961 534.698 185.44461 533.595 177.87261 534.063 177.87261 534.063 166.64961 563.276 155.56661 593.696 147.44761 619.782 108.72961 744.168 121.27261 795.644 130.82461 796.798c20.496 2.474 79.78-93.637 79.78-93.637 0 97.66 88.324 247.617 290.576 248.996a718.01 718.01 0 0 1 5.367 0C708.80161 950.778 797.12261 800.822 797.12261 703.162c0 0 59.284 96.111 79.783 93.637 9.55-1.154 22.093-52.63-16.623-177.017" fill="#000000"></path><path d="M434.38261 316.917c-27.9 1.24-51.745-30.106-53.24-69.956-1.518-39.877 19.858-73.207 47.764-74.454 27.875-1.224 51.703 30.109 53.218 69.974 1.527 39.877-19.853 73.2-47.742 74.436m206.67-69.956c-1.494 39.85-25.34 71.194-53.24 69.956-27.888-1.238-49.269-34.559-47.742-74.435 1.513-39.868 25.341-71.201 53.216-69.974 27.909 1.247 49.285 34.576 47.767 74.453" fill="#FFFFFF"></path><path d="M683.94261 368.627c-7.323-17.609-81.062-37.227-172.353-37.227h-0.98c-91.29 0-165.031 19.618-172.352 37.227a6.244 6.244 0 0 0-0.535 2.505c0 1.269 0.393 2.414 1.006 3.386 6.168 9.765 88.054 58.018 171.882 58.018h0.98c83.827 0 165.71-48.25 171.881-58.016a6.352 6.352 0 0 0 1.002-3.395c0-0.897-0.2-1.736-0.531-2.498" fill="#FAAD08"></path><path d="M467.63161 256.377c1.26 15.886-7.377 30-19.266 31.542-11.907 1.544-22.569-10.083-23.836-25.978-1.243-15.895 7.381-30.008 19.25-31.538 11.927-1.549 22.607 10.088 23.852 25.974m73.097 7.935c2.533-4.118 19.827-25.77 55.62-17.886 9.401 2.07 13.75 5.116 14.668 6.316 1.355 1.77 1.726 4.29 0.352 7.684-2.722 6.725-8.338 6.542-11.454 5.226-2.01-0.85-26.94-15.889-49.905 6.553-1.579 1.545-4.405 2.074-7.085 0.242-2.678-1.834-3.786-5.553-2.196-8.135" fill="#000000"></path><path d="M504.33261 584.495h-0.967c-63.568 0.752-140.646-7.504-215.286-21.92-6.391 36.262-10.25 81.838-6.936 136.196 8.37 137.384 91.62 223.736 220.118 224.996H506.48461c128.498-1.26 211.748-87.612 220.12-224.996 3.314-54.362-0.547-99.938-6.94-136.203-74.654 14.423-151.745 22.684-215.332 21.927" fill="#FFFFFF"></path><path d="M323.27461 577.016v137.468s64.957 12.705 130.031 3.91V591.59c-41.225-2.262-85.688-7.304-130.031-14.574" fill="#EB1C26"></path><path d="M788.09761 432.536s-121.98 40.387-283.743 41.539h-0.962c-161.497-1.147-283.328-41.401-283.744-41.539l-40.854 106.952c102.186 32.31 228.837 53.135 324.598 51.926l0.96-0.002c95.768 1.216 222.4-19.61 324.6-51.924l-40.855-106.952z" fill="#EB1C26"></path></svg></a>
                        <a class="brand-social-icon" href="javascript:void(0);" title="自助授权微信小程序" data-qr-image="/assets/images/xcx.png" data-qr-title="自助授权微信小程序"><svg t="1750605169831" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="20894" width="80" height="80"><path d="M512 967.68c251.668 0 455.68-204.012 455.68-455.68S763.668 56.32 512 56.32 56.32 260.332 56.32 512 260.332 967.68 512 967.68z m0-71.68c-212.07 0-384-171.93-384-384s171.93-384 384-384 384 171.93 384 384-171.93 384-384 384z" p-id="20895" fill="#1a9d17"></path><path d="M544.297 405.279a77.599 77.599 0 1 1 77.599 77.578 30.72 30.72 0 0 0 0 61.44c76.78 0 139.028-62.249 139.028-139.029S698.675 266.24 621.896 266.24s-139.039 62.249-139.039 139.028a30.72 30.72 0 0 0 61.44 0z m-61.44 213.217a77.588 77.588 0 0 1-155.177 0 77.588 77.588 0 0 1 77.588-77.599 30.72 30.72 0 0 0 0-61.44c-76.769 0-139.028 62.239-139.028 139.039 0 76.78 62.249 139.028 139.028 139.028 76.79 0 139.029-62.248 139.029-139.028a30.72 30.72 0 0 0-61.44 0z" p-id="20896" fill="#1a9d17"></path><path d="M482.857 402.156V619.93h61.44V402.156z" p-id="20897" fill="#1a9d17"></path></svg></a>
                    </div>
                </div>
            </div>
            <main class="form-container">
                <form id="registrationForm">
                    <div class="form-group">
                        <label for="computer_id">电脑编号</label>
                        <div class="input-wrapper">
                            <input type="text" id="computer_id" name="computer_id" placeholder="请输入6位电脑编号">
                        </div>
                        <small class="input-tip">不知道如何获取？<a href="https://bz.ffgz.xyz/#/use/getcode" target="_blank">查看教程</a></small>
                    </div>
                    <div class="form-group">
                        <label for="email">下单/绑定邮箱</label>
                        <div class="input-wrapper">
                            <input type="email" id="email" name="email" placeholder="电脑编号和邮箱至少填一项" >
                        </div>
                    </div>
                    <div class="form-group">
                        <label>选择授权码有效期</label>
                        <div class="radio-group-wrapper">
                            <div class="radio-group">
                                <input type="radio" name="expiry_option" value="7days" id="expiry_7days">
                                <label for="expiry_7days">7天</label>
                                <input type="radio" name="expiry_option" value="30days" id="expiry_30days">
                                <label for="expiry_30days">30天</label>
                                <input type="radio" name="expiry_option" value="365days" id="expiry_365days" checked>
                                <label for="expiry_365days">365天</label>
                                <input type="radio" name="expiry_option" value="forever" id="expiry_forever">
                                <label for="expiry_forever">永久</label>
                                <div class="full-width-radio">
                                    <input type="radio" name="expiry_option" value="custom" id="expiry_custom">
                                    <label for="expiry_custom">自定义日期</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="customExpiryDateContainer">
                        <label for="custom_date">选择到期日期</label>
                        <input type="text" id="custom_date" name="custom_date" placeholder="请选择日期...">
                    </div>
                    <button type="submit" class="submit-button">
                        <span class="spinner spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                        <span class="btn-text">立即生成授权码</span>
                    </button>
                </form>
                <div id="resultContainer"></div>
                <footer class="footer">
                    <div class="footer-links">
                        <a href="https://bz.ffgz.xyz/#/use/instead" target="_blank">如何激活永久会员？</a>
                        <span>·</span>
                        <a href="https://bz.ffgz.xyz/#/use/getcode" target="_blank">如何获取电脑编号？</a>
                        <span>·</span>
                        <a href="https://m.jian.fan/" target="_blank">在线商城</a>
                    </div>
                </footer>
            </main>
        </div>
    </div>

    <div id="qrCodePopup" class="qr-code-popup">
        <div class="qr-code-content">
            <span class="close-button">×</span>
            <h4 id="qrCodeTitle"></h4>
            <img id="qrCodeImage" src="" alt="QR Code">
            <p>请使用相应APP扫码</p>
        </div>
    </div>

    <div class="fab-container" id="fabContainer">
        <div class="fab-main-button" id="fabMainButton"><svg t="1750604965056" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="14429"><path d="M512.5 65C266.39 65 65 239.962 65 458.5l0.02 3.822c1.3 119.663 63.593 229.584 166.551 302.587l2.117 1.487-15.536 123.648c-4.13 32.878 19.174 62.88 52.052 67.012l0.607 0.073a60 60 0 0 0 47.688-15.626l104.851-97.307 1.823 0.32c28.553 4.962 57.76 7.484 87.327 7.484C758.61 852 960 677.038 960 458.5S758.61 65 512.5 65z m0 72C720.92 137 888 282.154 888 458.5S720.92 780 512.5 780c-29.973 0-59.461-3.008-88.054-8.9l-3.193-0.67-19.687-4.246-107.863 100.101 17.062-135.786-22.047-13.903c-0.569-0.361-1.041-0.663-1.414-0.903C193.068 655.055 137 560.5 137 458.5 137 282.154 304.08 137 512.5 137z" fill="#ffffff" p-id="14430"></path><path d="M300.795 389.917c-6.58 62.6 13.922 124.716 57.215 176.261 11.689 13.918 24.918 26.898 39.491 38.731l2.317 1.861 2.141 1.691-54.433 69.145-2.65-2.094c-0.406-0.323-0.766-0.61-1.08-0.863-19.573-15.706-37.393-33.088-53.171-51.874-57.651-68.64-85.932-153.267-77.611-239.444l87.781 6.586z" fill="#ffffff" p-id="14431"></path></svg></div>
        <div class="fab-options">
            <a href="javascript:void(0);" class="fab-option" data-qr-image="/assets/images/weixin_qr.png" data-qr-title="微信扫码联系"><svg viewBox="0 0 1024 1024"><path d="M683.058 364.695c11 0 22 1.016 32.943 1.976C686.564 230.064 538.896 128 370.681 128c-188.104 0.66-342.237 127.793-342.237 289.226 0 93.068 51.379 169.827 136.725 229.256L130.72 748.43l119.796-59.368c42.918 8.395 77.37 16.79 119.742 16.79 11 0 21.46-0.48 31.914-1.442a259.168 259.168 0 0 1-10.455-71.358c0.485-148.002 128.744-268.297 291.403-268.297l-0.06-0.06z m-184.113-91.992c25.99 0 42.913 16.79 42.913 42.575 0 25.188-16.923 42.579-42.913 42.579-25.45 0-51.38-16.85-51.38-42.58 0-25.784 25.93-42.574 51.38-42.574z m-239.544 85.154c-25.384 0-51.374-16.85-51.374-42.58 0-25.784 25.99-42.574 51.374-42.574 25.45 0 42.918 16.79 42.918 42.575 0 25.188-16.924 42.579-42.918 42.579z m736.155 271.655c0-135.647-136.725-246.527-290.983-246.527-162.655 0-290.918 110.88-290.918 246.527 0 136.128 128.263 246.587 290.918 246.587 33.972 0 68.423-8.395 102.818-16.85l93.809 50.973-25.93-84.677c68.907-51.93 120.286-119.815 120.286-196.033z m-385.275-42.58c-16.923 0-34.452-16.79-34.452-34.179 0-16.79 17.529-34.18 34.452-34.18 25.99 0 42.918 16.85 42.918 34.18 0 17.39-16.928 34.18-42.918 34.18z m188.165 0c-16.984 0-33.972-16.79-33.972-34.179 0-16.79 16.927-34.18 33.972-34.18 25.93 0 42.913 16.85 42.913 34.18 0 17.39-16.983 34.18-42.913 34.18z" fill="#09BB07"></path></svg></a>
            <a href="javascript:void(0);" class="fab-option" data-qr-image="/assets/images/qq_qr.png" data-qr-title="QQ扫码联系"><svg viewBox="0 0 1024 1024"><path d="M511.09761 957.257c-80.159 0-153.737-25.019-201.11-62.386-24.057 6.702-54.831 17.489-74.252 30.864-16.617 11.439-14.546 23.106-11.55 27.816 13.15 20.689 225.583 13.211 286.912 6.767v-3.061z" fill="#FAAD08"></path><path d="M496.65061 957.257c80.157 0 153.737-25.019 201.11-62.386 24.057 6.702 54.83 17.489 74.253 30.864 16.616 11.439 14.543 23.106 11.55 27.816-13.15 20.689-225.584 13.211-286.914 6.767v-3.061z" fill="#FAAD0O8"></path><path d="M497.12861 474.524c131.934-0.876 237.669-25.783 273.497-35.34 8.541-2.28 13.11-6.364 13.11-6.364 0.03-1.172 0.542-20.952 0.542-31.155C784.27761 229.833 701.12561 57.173 496.64061 57.162 292.15661 57.173 209.00061 229.832 209.00061 401.665c0 10.203 0.516 29.983 0.547 31.155 0 0 3.717 3.821 10.529 5.67 33.078 8.98 140.803 35.139 276.08 36.034h0.972z" fill="#000000"></path><path d="M860.28261 619.782c-8.12-26.086-19.204-56.506-30.427-85.72 0 0-6.456-0.795-9.718 0.148-100.71 29.205-222.773 47.818-315.792 46.695h-0.962C410.88561 582.017 289.65061 563.617 189.27961 534.698 185.44461 533.595 177.87261 534.063 177.87261 534.063 166.64961 563.276 155.56661 593.696 147.44761 619.782 108.72961 744.168 121.27261 795.644 130.82461 796.798c20.496 2.474 79.78-93.637 79.78-93.637 0 97.66 88.324 247.617 290.576 248.996a718.01 718.01 0 0 1 5.367 0C708.80161 950.778 797.12261 800.822 797.12261 703.162c0 0 59.284 96.111 79.783 93.637 9.55-1.154 22.093-52.63-16.623-177.017" fill="#000000"></path><path d="M434.38261 316.917c-27.9 1.24-51.745-30.106-53.24-69.956-1.518-39.877 19.858-73.207 47.764-74.454 27.875-1.224 51.703 30.109 53.218 69.974 1.527 39.877-19.853 73.2-47.742 74.436m206.67-69.956c-1.494 39.85-25.34 71.194-53.24 69.956-27.888-1.238-49.269-34.559-47.742-74.435 1.513-39.868 25.341-71.201 53.216-69.974 27.909 1.247 49.285 34.576 47.767 74.453" fill="#FFFFFF"></path><path d="M683.94261 368.627c-7.323-17.609-81.062-37.227-172.353-37.227h-0.98c-91.29 0-165.031 19.618-172.352 37.227a6.244 6.244 0 0 0-0.535 2.505c0 1.269 0.393 2.414 1.006 3.386 6.168 9.765 88.054 58.018 171.882 58.018h0.98c83.827 0 165.71-48.25 171.881-58.016a6.352 6.352 0 0 0 1.002-3.395c0-0.897-0.2-1.736-0.531-2.498" fill="#FAAD08"></path><path d="M467.63161 256.377c1.26 15.886-7.377 30-19.266 31.542-11.907 1.544-22.569-10.083-23.836-25.978-1.243-15.895 7.381-30.008 19.25-31.538 11.927-1.549 22.607 10.088 23.852 25.974m73.097 7.935c2.533-4.118 19.827-25.77 55.62-17.886 9.401 2.07 13.75 5.116 14.668 6.316 1.355 1.77 1.726 4.29 0.352 7.684-2.722 6.725-8.338 6.542-11.454 5.226-2.01-0.85-26.94-15.889-49.905 6.553-1.579 1.545-4.405 2.074-7.085 0.242-2.678-1.834-3.786-5.553-2.196-8.135" fill="#000000"></path><path d="M504.33261 584.495h-0.967c-63.568 0.752-140.646-7.504-215.286-21.92-6.391 36.262-10.25 81.838-6.936 136.196 8.37 137.384 91.62 223.736 220.118 224.996H506.48461c128.498-1.26 211.748-87.612 220.12-224.996 3.314-54.362-0.547-99.938-6.94-136.203-74.654 14.423-151.745 22.684-215.332 21.927" fill="#FFFFFF"></path><path d="M323.27461 577.016v137.468s64.957 12.705 130.031 3.91V591.59c-41.225-2.262-85.688-7.304-130.031-14.574" fill="#EB1C26"></path><path d="M788.09761 432.536s-121.98 40.387-283.743 41.539h-0.962c-161.497-1.147-283.328-41.401-283.744-41.539l-40.854 106.952c102.186 32.31 228.837 53.135 324.598 51.926l0.96-0.002c95.768 1.216 222.4-19.61 324.6-51.924l-40.855-106.952z" fill="#EB1C26"></path></svg></a>
            <a href="javascript:void(0);" class="fab-option" data-qr-image="/assets/images/xcx.png" data-qr-title="自助授权微信小程序"><svg t="1750605169831" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="20894" width="80" height="80"><path d="M512 967.68c251.668 0 455.68-204.012 455.68-455.68S763.668 56.32 512 56.32 56.32 260.332 56.32 512 260.332 967.68 512 967.68z m0-71.68c-212.07 0-384-171.93-384-384s171.93-384 384-384 384 171.93 384 384-171.93 384-384 384z" p-id="20895" fill="#1a9d17"></path><path d="M544.297 405.279a77.599 77.599 0 1 1 77.599 77.578 30.72 30.72 0 0 0 0 61.44c76.78 0 139.028-62.249 139.028-139.029S698.675 266.24 621.896 266.24s-139.039 62.249-139.039 139.028a30.72 30.72 0 0 0 61.44 0z m-61.44 213.217a77.588 77.588 0 0 1-155.177 0 77.588 77.588 0 0 1 77.588-77.599 30.72 30.72 0 0 0 0-61.44c-76.769 0-139.028 62.239-139.028 139.039 0 76.78 62.249 139.028 139.028 139.028 76.79 0 139.029-62.248 139.029-139.028a30.72 30.72 0 0 0-61.44 0z" p-id="20896" fill="#1a9d17"></path><path d="M482.857 402.156V619.93h61.44V402.156z" p-id="20897" fill="#1a9d17"></path></svg></a>
        </div>
    </div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('registrationForm');
        const resultContainer = document.getElementById('resultContainer');
        const computerIdInput = document.getElementById('computer_id');
        const emailInput = document.getElementById('email');
        const expiryOptionRadios = document.querySelectorAll('input[name="expiry_option"]');
        const customExpiryDateContainer = document.getElementById('customExpiryDateContainer');
        const submitButton = form.querySelector('.submit-button');
        
        const datePicker = flatpickr("#custom_date", {
            locale: "zh",
            altInput: true,
            altFormat: "Y年m月d日",
            dateFormat: "Y-m-d",
            minDate: "today",
        });

        async function apiCall(endpoint, data) {
            submitButton.classList.add('loading');
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                return await response.json();
            } catch (error) {
                console.error('Fetch error:', error);
                return { success: false, message: '网络请求失败，请稍后再试。' };
            } finally {
                submitButton.classList.remove('loading');
            }
        }

        computerIdInput.addEventListener('input', function() {
            this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '').substring(0, 6);
        });

        expiryOptionRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                customExpiryDateContainer.classList.toggle('show', this.value === 'custom');
            });
        });

        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            resultContainer.innerHTML = '';
            
            const computerId = computerIdInput.value.trim(); 
            const email = emailInput.value.trim(); 
            const expiryOption = document.querySelector('input[name="expiry_option"]:checked').value;
            let customDate = '';
        
            if (!computerId && !email) {
                showError('电脑编号和下单邮箱请至少输入一项。');
                return;
            }
            if (computerId && !/^[A-Z0-9]{6}$/.test(computerId)) {
                showError('电脑编号格式不正确，必须是6位字母或数字。');
                return;
            }
            if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showError('下单邮箱格式不正确。');
                return;
            }
            if (expiryOption === 'custom') {
                customDate = datePicker.input.value;
                if (!customDate) { showError('请选择自定义到期日期！'); return; }
            }
            
            const data = { 
                action: 'generate',
                computer_id: computerId, 
                email: email, 
                expiry_option: expiryOption, 
                custom_date: customDate 
            };
            
            const result = await apiCall('https://ffcell.jian.fan/generate.php', data);

            if (result.success) {
                showSuccessResult(result);
            } else {
                showError(result.message || '未知错误，请联系客服。');
            }
            resultContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });

        function showSuccessResult(data) {
            const details = data.details;
            let detailsHtml = '';

            if (details.user_type === 'special_auth') {
                detailsHtml = `
                    <div class="detail-item"><span class="label">用户身份</span><span class="value highlight-special">特殊授权</span></div>
                    <div class="detail-item"><span class="label">电脑编号</span><span class="value">${details.computer_id}</span></div>
                    <div class="detail-item"><span class="label">绑定邮箱</span><span class="value">${details.email || 'N/A'}</span></div>
                    <div class="detail-item"><span class="label">授权码到期</span><span class="value">${details.generated_expire_date}</span></div>
                    <div class="detail-item"><span class="label">高级授权状态</span><span class="value highlight-green">${details.allowance_text}</span></div>
                `;
            } else { 
                detailsHtml = `
                    <div class="detail-item"><span class="label">电脑编号</span><span class="value">${details.computer_id}</span></div>
                    <div class="detail-item"><span class="label">下单邮箱</span><span class="value">${details.email || 'N/A'}</span></div>
                    <div class="detail-item"><span class="label">购买套餐</span><span class="value">${details.bought_duration_text || 'N/A'}</span></div>
                    <div class="detail-item"><span class="label">授权码到期</span><span class="value">${details.generated_expire_date}</span></div>
                    <div class="detail-item"><span class="label">剩余更换次数</span><span class="value highlight">${details.formatted_remaining_changes_text}</span></div>
                `;
            }

            resultContainer.innerHTML = `<div class="result-card success"><h3>授权码已生成</h3><div class="access-code-box" id="accessCodeBox"><div class="access-code-display">${data.access_code}</div><small class="copy-hint">点击上方授权码即可复制</small><div class="copy-feedback">已复制!</div></div><div class="details-divider">授权详情</div><div class="details-grid">${detailsHtml}</div></div>`;
            document.getElementById('accessCodeBox').addEventListener('click', function() { copyToClipboard(data.access_code, this.querySelector('.copy-feedback')); });
        }
        
        function showError(message) {
            resultContainer.innerHTML = `<div class="result-card error"><h3>操作失败</h3><p>${message}</p></div>`;
        }

        function copyToClipboard(text, feedbackElement) {
            navigator.clipboard.writeText(text).then(() => {
                feedbackElement.classList.add('show');
                setTimeout(() => feedbackElement.classList.remove('show'), 2000);
            }).catch(err => {
                console.error('复制失败: ', err);
                alert('复制失败，您的浏览器可能不支持此功能。');
            });
        }
        
        const qrCodePopup = document.getElementById('qrCodePopup');
        const qrCodeImage = document.getElementById('qrCodeImage');
        const qrCodeTitle = document.getElementById('qrCodeTitle');
        const closeButton = qrCodePopup.querySelector('.close-button');
        const brandSocialIcons = document.querySelectorAll('.brand-social-icon');
        const fabOptions = document.querySelectorAll('.fab-option');
        
        function showQrPopup(el) {
            qrCodeImage.src = el.dataset.qrImage;
            qrCodeTitle.textContent = el.dataset.qrTitle || '扫码联系';
            qrCodePopup.classList.add('show');
        }
        function hideQrPopup() {
            qrCodePopup.classList.remove('show');
        }

        const allQrIcons = [...brandSocialIcons, ...fabOptions];
        allQrIcons.forEach(icon => {
            icon.addEventListener('click', function() { showQrPopup(this); });
        });
        
        closeButton.addEventListener('click', hideQrPopup);
        qrCodePopup.addEventListener('click', (e) => {
            if (e.target === qrCodePopup) hideQrPopup();
        });

        const fabContainer = document.getElementById('fabContainer');
        if (fabContainer) {
            const fabMainButton = document.getElementById('fabMainButton');
            const fabOptionsContainer = fabContainer.querySelector('.fab-options');
            let hasMoved = false;

            fabMainButton.addEventListener('click', (e) => {
                if (!hasMoved) {
                    const rect = fabContainer.getBoundingClientRect();
                    if (rect.top > window.innerHeight / 2) {
                        fabOptionsContainer.classList.remove('expand-down');
                        fabOptionsContainer.classList.add('expand-up');
                    } else {
                        fabOptionsContainer.classList.remove('expand-up');
                        fabOptionsContainer.classList.add('expand-down');
                    }
                    fabContainer.classList.toggle('open');
                }
            });

            document.addEventListener('click', (e) => {
                if (fabContainer && !fabContainer.contains(e.target)) {
                    fabContainer.classList.remove('open');
                }
            });

            let isDragging = false;
            let startX, startY, startLeft, startTop;
            
            const onPointerDown = (e) => {
                isDragging = true;
                hasMoved = false;
                const pointer = e.touches ? e.touches[0] : e;
                startX = pointer.clientX;
                startY = pointer.clientY;
                startLeft = fabContainer.offsetLeft;
                startTop = fabContainer.offsetTop;
                fabContainer.style.transition = 'none';
                document.addEventListener('pointermove', onPointerMove);
                document.addEventListener('pointerup', onPointerUp);
            };

            const onPointerMove = (e) => {
                if (!isDragging) return;
                const pointer = e.touches ? e.touches[0] : e;
                const dx = pointer.clientX - startX;
                const dy = pointer.clientY - startY;
                if (Math.abs(dx) > 5 || Math.abs(dy) > 5) {
                    hasMoved = true;
                }
                fabContainer.style.left = `${startLeft + dx}px`;
                fabContainer.style.top = `${startTop + dy}px`;
            };

            const onPointerUp = () => {
                isDragging = false;
                fabContainer.style.transition = 'left 0.3s ease, top 0.3s ease';
                document.removeEventListener('pointermove', onPointerMove);
                document.removeEventListener('pointerup', onPointerUp);
            };
            
            fabMainButton.addEventListener('pointerdown', onPointerDown);
        }
    });
</script>

</body>
</html>
